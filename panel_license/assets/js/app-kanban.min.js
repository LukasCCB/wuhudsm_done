"use strict";(async function(){let boards;const kanbanSidebar=document.querySelector(".kanban-update-item-sidebar"),kanbanWrapper=document.querySelector(".kanban-wrapper"),commentEditor=document.querySelector(".comment-editor"),kanbanAddNewBoard=document.querySelector(".kanban-add-new-board"),kanbanAddNewInput=[].slice.call(document.querySelectorAll(".kanban-add-board-input")),kanbanAddBoardBtn=document.querySelector(".kanban-add-board-btn"),datePicker=document.querySelector("#due-date"),select2=$(".select2"),assetsPath=document.querySelector("html").getAttribute("data-assets-path");const kanbanOffcanvas=new bootstrap.Offcanvas(kanbanSidebar);const kanbanResponse=await fetch(assetsPath+"json/kanban.json");if(!kanbanResponse.ok){console.error("error",kanbanResponse)}boards=await kanbanResponse.json();if(datePicker){datePicker.flatpickr({monthSelectorType:"static",altInput:true,altFormat:"j F, Y",dateFormat:"Y-m-d"})}if(select2.length){function renderLabels(option){if(!option.id){return option.text}var $badge="<div class='badge "+$(option.element).data("color")+" rounded-pill'> "+option.text+"</div>";return $badge}select2.each(function(){var $this=$(this);select2Focus($this);$this.wrap("<div class='position-relative'></div>").select2({placeholder:"Select Label",dropdownParent:$this.parent(),templateResult:renderLabels,templateSelection:renderLabels,escapeMarkup:function(es){return es}})})}if(commentEditor){new Quill(commentEditor,{modules:{toolbar:".comment-toolbar"},placeholder:"Write a Comment... ",theme:"snow"})}function renderBoardDropdown(){return"<div class='dropdown'>"+"<i class='dropdown-toggle mdi mdi-dots-vertical mdi-24px text-muted cursor-pointer' id='board-dropdown' data-bs-toggle='dropdown' aria-haspopup='true' aria-expanded='false'></i>"+"<div class='dropdown-menu dropdown-menu-end' aria-labelledby='board-dropdown'>"+"<a class='dropdown-item delete-board' href='javascript:void(0)'> <i class='mdi mdi-delete-outline'></i> <span class='align-middle'>Delete</span></a>"+"<a class='dropdown-item' href='javascript:void(0)'><i class='mdi mdi-rename-outline'></i> <span class='align-middle'>Rename</span></a>"+"<a class='dropdown-item' href='javascript:void(0)'><i class='mdi mdi-archive-outline'></i> <span class='align-middle'>Archive</span></a>"+"</div>"+"</div>"}function renderDropdown(){return"<div class='dropdown kanban-tasks-item-dropdown'>"+"<i class='dropdown-toggle mdi mdi-dots-vertical' id='kanban-tasks-item-dropdown' data-bs-toggle='dropdown' aria-haspopup='true' aria-expanded='false'></i>"+"<div class='dropdown-menu dropdown-menu-end' aria-labelledby='kanban-tasks-item-dropdown'>"+"<a class='dropdown-item' href='javascript:void(0)'>Copy task link</a>"+"<a class='dropdown-item' href='javascript:void(0)'>Duplicate task</a>"+"<a class='dropdown-item delete-task' href='javascript:void(0)'>Delete</a>"+"</div>"+"</div>"}function renderHeader(color,text){return"<div class='d-flex justify-content-between flex-wrap align-items-center mb-2 pb-1'>"+"<div class='item-badges d-flex'> "+"<div class='badge rounded-pill bg-label-"+color+"'> "+text+"</div>"+"</div>"+renderDropdown()+"</div>"}function renderAvatar(images,pullUp,size,margin,members){var $transition=pullUp?" pull-up":"",$size=size?"avatar-"+size+"":"",member=members==undefined?" ":members.split(",");return images==undefined?" ":images.split(",").map(function(img,index,arr){var $margin=margin&&index!==arr.length-1?" me-"+margin+"":"";return"<div class='avatar "+$size+$margin+"'"+"data-bs-toggle='tooltip' data-bs-placement='top'"+"title='"+member[index]+"'"+">"+"<img src='"+assetsPath+"img/avatars/"+img+"' alt='Avatar' class='rounded-circle "+$transition+"'>"+"</div>"}).join(" ")}function renderFooter(attachments,comments,assigned,members){return"<div class='d-flex justify-content-between align-items-center flex-wrap mt-2 pt-1'>"+"<div> <span class='align-middle me-2'><i class='mdi mdi-paperclip mdi-20px me-1'></i>"+"<small class='attachments'>"+attachments+"</small>"+"</span> <span class='align-middle'><i class='mdi mdi-message-outline mdi-20px me-1'></i>"+"<small> "+comments+" </small>"+"</span></div>"+"<div class='avatar-group d-flex align-items-center assigned-avatar'>"+renderAvatar(assigned,true,"xs",null,members)+"</div>"+"</div>"}const kanban=new jKanban({element:".kanban-wrapper",gutter:"15px",widthBoard:"250px",dragItems:true,boards:boards,dragBoards:true,addItemButton:true,buttonContent:"+ Add Item",itemAddOptions:{enabled:true,content:"+ Add New Item",class:"kanban-title-button btn btn-default btn-md shadow-none text-capitalize fw-normal",footer:false},click:function(el){let element=el;let title=element.getAttribute("data-eid")?element.querySelector(".kanban-text").textContent:element.textContent,date=element.getAttribute("data-due-date"),dateObj=new Date,year=dateObj.getFullYear(),dateToUse=date?date+", "+year:dateObj.getDate()+" "+dateObj.toLocaleString("en",{month:"long"})+", "+year,label=element.getAttribute("data-badge-text"),avatars=element.getAttribute("data-assigned");kanbanOffcanvas.show();kanbanSidebar.querySelector("#title").value=title;kanbanSidebar.querySelector("#due-date").nextSibling.value=dateToUse;$(".kanban-update-item-sidebar").find(select2).val(label).trigger("change");kanbanSidebar.querySelector(".assigned").innerHTML="";kanbanSidebar.querySelector(".assigned").insertAdjacentHTML("afterbegin",renderAvatar(avatars,false,"sm","2",el.getAttribute("data-members"))+"<div class='avatar avatar-sm ms-2'>"+"<span class='avatar-initial rounded-circle bg-label-secondary'><i class='mdi mdi-plus'></i></span>"+"</div>")},buttonClick:function(el,boardId){const addNew=document.createElement("form");addNew.setAttribute("class","new-item-form");addNew.innerHTML='<div class="mb-3">'+'<textarea class="form-control add-new-item" rows="3" placeholder="Add Content" autofocus required></textarea>'+"</div>"+'<div class="mb-3">'+'<button type="submit" class="btn btn-primary btn-sm me-2">Add</button>'+'<button type="button" class="btn btn-outline-secondary btn-sm cancel-add-item">Cancel</button>'+"</div>";kanban.addForm(boardId,addNew);addNew.addEventListener("submit",function(e){e.preventDefault();const currentBoard=[].slice.call(document.querySelectorAll(".kanban-board[data-id="+boardId+"] .kanban-item"));kanban.addElement(boardId,{title:"<span class='kanban-text'>"+e.target[0].value+"</span>",id:boardId+"-"+currentBoard.length+1});const kanbanText=[].slice.call(document.querySelectorAll(".kanban-board[data-id="+boardId+"] .kanban-text"));kanbanText.forEach(function(e){e.insertAdjacentHTML("beforebegin",renderDropdown())});const newTaskDropdown=[].slice.call(document.querySelectorAll(".kanban-item .kanban-tasks-item-dropdown"));if(newTaskDropdown){newTaskDropdown.forEach(function(e){e.addEventListener("click",function(el){el.stopPropagation()})})}const deleteTask=[].slice.call(document.querySelectorAll(".kanban-board[data-id="+boardId+"] .delete-task"));deleteTask.forEach(function(e){e.addEventListener("click",function(){const id=this.closest(".kanban-item").getAttribute("data-eid");kanban.removeElement(id)})});addNew.remove()});addNew.querySelector(".cancel-add-item").addEventListener("click",function(e){addNew.remove()})}});if(kanbanWrapper){new PerfectScrollbar(kanbanWrapper)}const kanbanContainer=document.querySelector(".kanban-container"),kanbanTitleBoard=[].slice.call(document.querySelectorAll(".kanban-title-board")),kanbanItem=[].slice.call(document.querySelectorAll(".kanban-item"));if(kanbanItem){kanbanItem.forEach(function(el){const element="<span class='kanban-text'>"+el.textContent+"</span>";let img="";if(el.getAttribute("data-image")!==null){img="<img class='img-fluid mb-2 rounded-3' src='"+assetsPath+"img/elements/"+el.getAttribute("data-image")+"'>"}el.textContent="";if(el.getAttribute("data-badge")!==undefined&&el.getAttribute("data-badge-text")!==undefined){el.insertAdjacentHTML("afterbegin",renderHeader(el.getAttribute("data-badge"),el.getAttribute("data-badge-text"))+img+element)}if(el.getAttribute("data-comments")!==undefined||el.getAttribute("data-due-date")!==undefined||el.getAttribute("data-assigned")!==undefined){el.insertAdjacentHTML("beforeend",renderFooter(el.getAttribute("data-attachments"),el.getAttribute("data-comments"),el.getAttribute("data-assigned"),el.getAttribute("data-members")))}})}const tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));tooltipTriggerList.map(function(tooltipTriggerEl){return new bootstrap.Tooltip(tooltipTriggerEl)});const tasksItemDropdown=[].slice.call(document.querySelectorAll(".kanban-tasks-item-dropdown"));if(tasksItemDropdown){tasksItemDropdown.forEach(function(e){e.addEventListener("click",function(el){el.stopPropagation()})})}if(kanbanAddBoardBtn){kanbanAddBoardBtn.addEventListener("click",()=>{kanbanAddNewInput.forEach(el=>{el.value="";el.classList.toggle("d-none")})})}if(kanbanContainer){kanbanContainer.appendChild(kanbanAddNewBoard)}if(kanbanTitleBoard){kanbanTitleBoard.forEach(function(elem){elem.addEventListener("mouseenter",function(){this.contentEditable="true"});elem.insertAdjacentHTML("afterend",renderBoardDropdown())})}const deleteBoards=[].slice.call(document.querySelectorAll(".delete-board"));if(deleteBoards){deleteBoards.forEach(function(elem){elem.addEventListener("click",function(){const id=this.closest(".kanban-board").getAttribute("data-id");kanban.removeBoard(id)})})}const deleteTask=[].slice.call(document.querySelectorAll(".delete-task"));if(deleteTask){deleteTask.forEach(function(e){e.addEventListener("click",function(){const id=this.closest(".kanban-item").getAttribute("data-eid");kanban.removeElement(id)})})}const cancelAddNew=document.querySelector(".kanban-add-board-cancel-btn");if(cancelAddNew){cancelAddNew.addEventListener("click",function(){kanbanAddNewInput.forEach(el=>{el.classList.toggle("d-none")})})}if(kanbanAddNewBoard){kanbanAddNewBoard.addEventListener("submit",function(e){e.preventDefault();const thisEle=this,value=thisEle.querySelector(".form-control").value,id=value.replace(/\s+/g,"-").toLowerCase();kanban.addBoards([{id:id,title:value}]);const kanbanBoardLastChild=document.querySelectorAll(".kanban-board:last-child")[0];if(kanbanBoardLastChild){const header=kanbanBoardLastChild.querySelector(".kanban-title-board");header.insertAdjacentHTML("afterend",renderBoardDropdown());kanbanBoardLastChild.querySelector(".kanban-title-board").addEventListener("mouseenter",function(){this.contentEditable="true"})}const deleteNewBoards=kanbanBoardLastChild.querySelector(".delete-board");if(deleteNewBoards){deleteNewBoards.addEventListener("click",function(){const id=this.closest(".kanban-board").getAttribute("data-id");kanban.removeBoard(id)})}if(kanbanAddNewInput){kanbanAddNewInput.forEach(el=>{el.classList.add("d-none")})}if(kanbanContainer){kanbanContainer.appendChild(kanbanAddNewBoard)}})}kanbanSidebar.addEventListener("hidden.bs.offcanvas",function(){kanbanSidebar.querySelector(".ql-editor").firstElementChild.innerHTML=""});if(kanbanSidebar){kanbanSidebar.addEventListener("shown.bs.offcanvas",function(){const tooltipTriggerList=[].slice.call(kanbanSidebar.querySelectorAll('[data-bs-toggle="tooltip"]'));tooltipTriggerList.map(function(tooltipTriggerEl){return new bootstrap.Tooltip(tooltipTriggerEl)})})}})();