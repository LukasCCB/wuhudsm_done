"use strict";document.addEventListener("DOMContentLoaded",function(){(function(){const emailList=document.querySelector(".email-list"),emailListItems=[].slice.call(document.querySelectorAll(".email-list-item")),emailListItemInputs=[].slice.call(document.querySelectorAll(".email-list-item-input")),emailView=document.querySelector(".app-email-view-content"),emailFilters=document.querySelector(".email-filters"),emailFilterByFolders=[].slice.call(document.querySelectorAll(".email-filter-folders li")),emailEditor=document.querySelector(".email-editor"),appEmailSidebar=document.querySelector(".app-email-sidebar"),appOverlay=document.querySelector(".app-overlay"),emailReplyEditor=document.querySelector(".email-reply-editor"),bookmarkEmail=[].slice.call(document.querySelectorAll(".email-list-item-bookmark")),selectAllEmails=document.getElementById("email-select-all"),emailSearch=document.querySelector(".email-search-input"),toggleCC=document.querySelector(".email-compose-toggle-cc"),toggleBCC=document.querySelector(".email-compose-toggle-bcc"),emailCompose=document.querySelector(".app-email-compose"),emailListDelete=document.querySelector(".email-list-delete"),emailListRead=document.querySelector(".email-list-read"),emailListEmpty=document.querySelector(".email-list-empty"),refreshEmails=document.querySelector(".email-refresh"),emailViewContainer=document.getElementById("app-email-view"),emailFilterFolderLists=[].slice.call(document.querySelectorAll(".email-filter-folders li")),emailListItemActions=[].slice.call(document.querySelectorAll(".email-list-item-actions li"));if(emailList){let emailListInstance=new PerfectScrollbar(emailList,{wheelPropagation:false,suppressScrollX:true})}if(emailFilters){new PerfectScrollbar(emailFilters,{wheelPropagation:false,suppressScrollX:true})}if(emailView){new PerfectScrollbar(emailView,{wheelPropagation:false,suppressScrollX:true})}if(emailEditor){new Quill(".email-editor",{modules:{toolbar:".email-editor-toolbar"},placeholder:"Write your message... ",theme:"snow"})}if(emailReplyEditor){new Quill(".email-reply-editor",{modules:{toolbar:".email-reply-toolbar"},placeholder:"Write your message... ",theme:"snow"})}if(bookmarkEmail){bookmarkEmail.forEach(emailItem=>{emailItem.addEventListener("click",e=>{let emailItem=e.currentTarget.parentNode.parentNode;let starredAttr=emailItem.getAttribute("data-starred");e.stopPropagation();if(!starredAttr){emailItem.setAttribute("data-starred","true")}else{emailItem.removeAttribute("data-starred")}})})}if(selectAllEmails){selectAllEmails.addEventListener("click",e=>{if(e.currentTarget.checked){emailListItemInputs.forEach(c=>c.checked=1)}else{emailListItemInputs.forEach(c=>c.checked=0)}})}if(emailListItemInputs){emailListItemInputs.forEach(emailListItemInput=>{emailListItemInput.addEventListener("click",e=>{e.stopPropagation();let emailListItemInputCount=0;emailListItemInputs.forEach(emailListItemInput=>{if(emailListItemInput.checked){emailListItemInputCount++}});if(emailListItemInputCount<emailListItemInputs.length){if(emailListItemInputCount==0){selectAllEmails.indeterminate=false}else{selectAllEmails.indeterminate=true}}else{if(emailListItemInputCount==emailListItemInputs.length){selectAllEmails.indeterminate=false;selectAllEmails.checked=true}else{selectAllEmails.indeterminate=false}}})})}if(emailSearch){emailSearch.addEventListener("keyup",e=>{let searchValue=e.currentTarget.value.toLowerCase(),searchEmailListItems={},selectedFolderFilter=document.querySelector(".email-filter-folders .active").getAttribute("data-target");if(selectedFolderFilter!="inbox"){searchEmailListItems=[].slice.call(document.querySelectorAll(".email-list-item[data-"+selectedFolderFilter+'="true"]'))}else{searchEmailListItems=[].slice.call(document.querySelectorAll(".email-list-item"))}searchEmailListItems.forEach(searchEmailListItem=>{let searchEmailListItemText=searchEmailListItem.textContent.toLowerCase();if(searchValue){if(-1<searchEmailListItemText.indexOf(searchValue)){searchEmailListItem.classList.add("d-block")}else{searchEmailListItem.classList.add("d-none")}}else{searchEmailListItem.classList.remove("d-none")}})})}emailFilterByFolders.forEach(emailFilterByFolder=>{emailFilterByFolder.addEventListener("click",e=>{let currentTarget=e.currentTarget,currentTargetData=currentTarget.getAttribute("data-target");appEmailSidebar.classList.remove("show");appOverlay.classList.remove("show");Helpers._removeClass("active",emailFilterByFolders);currentTarget.classList.add("active");emailListItems.forEach(emailListItem=>{if(currentTargetData=="inbox"){emailListItem.classList.add("d-block");emailListItem.classList.remove("d-none")}else if(emailListItem.hasAttribute("data-"+currentTargetData)){emailListItem.classList.add("d-block");emailListItem.classList.remove("d-none")}else{emailListItem.classList.add("d-none");emailListItem.classList.remove("d-block")}})})});if(toggleBCC){toggleBCC.addEventListener("click",e=>{Helpers._toggleClass(document.querySelector(".email-compose-bcc"),"d-block","d-none")})}if(toggleCC){toggleCC.addEventListener("click",e=>{Helpers._toggleClass(document.querySelector(".email-compose-cc"),"d-block","d-none")})}emailCompose.addEventListener("hidden.bs.modal",event=>{document.querySelector(".email-editor .ql-editor").innerHTML="";$("#emailContacts").val("");initSelect2()});if(emailListDelete){emailListDelete.addEventListener("click",e=>{emailListItemInputs.forEach(emailListItemInput=>{if(emailListItemInput.checked){emailListItemInput.parentNode.closest("li.email-list-item").remove()}});selectAllEmails.indeterminate=false;selectAllEmails.checked=false;var emailListItem=document.querySelectorAll(".email-list-item");if(emailListItem.length==0){emailListEmpty.classList.remove("d-none")}})}if(emailListRead){emailListRead.addEventListener("click",e=>{emailListItemInputs.forEach(emailListItemInput=>{if(emailListItemInput.checked){emailListItemInput.checked=false;emailListItemInput.parentNode.closest("li.email-list-item").classList.add("email-marked-read");let emailItemEnvelop=emailListItemInput.parentNode.closest("li.email-list-item").querySelector(".email-list-item-actions li");if(Helpers._hasClass("email-read",emailItemEnvelop)){emailItemEnvelop.classList.remove("email-read");emailItemEnvelop.classList.add("email-unread");emailItemEnvelop.querySelector("i").classList.remove("mdi-email-open-outline");emailItemEnvelop.querySelector("i").classList.add("mdi-email-outline")}}});selectAllEmails.indeterminate=false;selectAllEmails.checked=false})}if(refreshEmails&&emailList){let emailListJq=$(".email-list"),emailListInstance=new PerfectScrollbar(emailList,{wheelPropagation:false,suppressScrollX:true});refreshEmails.addEventListener("click",e=>{emailListJq.block({message:'<div class="spinner-border text-primary" role="status"></div>',timeout:1e3,css:{backgroundColor:"transparent",border:"0"},overlayCSS:{backgroundColor:"#000",opacity:.1},onBlock:function(){emailListInstance.settings.suppressScrollY=true},onUnblock:function(){emailListInstance.settings.suppressScrollY=false}})})}let earlierMsg=$(".email-earlier-msgs");if(earlierMsg.length){earlierMsg.on("click",function(){let $this=$(this);$this.parents().find(".email-card-last").addClass("hide-pseudo");$this.next(".email-card-prev").slideToggle();$this.remove()})}let emailContacts=$("#emailContacts");function initSelect2(){if(emailContacts.length){function renderContactsAvatar(option){if(!option.id){return option.text}let $avatar="<div class='d-flex flex-wrap align-items-center lh-1 me-1'>"+"<div class='avatar avatar-xs me-2 w-px-20 h-px-20'>"+"<img src='"+assetsPath+"img/avatars/"+$(option.element).data("avatar")+"' alt='avatar' class='rounded-circle' />"+"</div>"+option.text+"</div>";return $avatar}emailContacts.wrap('<div class="position-relative"></div>').select2({placeholder:"Select value",dropdownParent:emailContacts.parent(),closeOnSelect:false,templateResult:renderContactsAvatar,templateSelection:renderContactsAvatar,escapeMarkup:function(es){return es}})}}initSelect2();let emailViewContent=$(".app-email-view-content");emailViewContent.find(".scroll-to-reply").on("click",function(){if(emailViewContent[0].scrollTop===0){emailViewContent.animate({scrollTop:emailViewContent[0].scrollHeight},1500)}});if(emailFilterFolderLists){emailFilterFolderLists.forEach(emailFilterFolderList=>{emailFilterFolderList.addEventListener("click",e=>{emailViewContainer.classList.remove("show")})})}if(emailListItemActions){emailListItemActions.forEach(emailListItemAction=>{emailListItemAction.addEventListener("click",e=>{e.stopPropagation();let currentTarget=e.currentTarget;if(Helpers._hasClass("email-delete",currentTarget)){currentTarget.parentNode.closest("li.email-list-item").remove();var emailListItem=document.querySelectorAll(".email-list-item");if(emailListItem.length==0){emailListEmpty.classList.remove("d-none")}}else if(Helpers._hasClass("email-read",currentTarget)){currentTarget.parentNode.closest("li.email-list-item").classList.add("email-marked-read");Helpers._toggleClass(currentTarget,"email-read","email-unread");Helpers._toggleClass(currentTarget.querySelector("i"),"mdi-email-open-outline","mdi-email-outline")}else if(Helpers._hasClass("email-unread",currentTarget)){currentTarget.parentNode.closest("li.email-list-item").classList.remove("email-marked-read");Helpers._toggleClass(currentTarget,"email-read","email-unread");Helpers._toggleClass(currentTarget.querySelector("i"),"mdi-email-open-outline","mdi-email-outline")}})})}})()});